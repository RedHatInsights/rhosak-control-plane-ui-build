"use strict";(self.webpackChunkkas_ui=self.webpackChunkkas_ui||[]).push([[8364],{48364:(e,t,n)=>{n.d(t,{H:()=>b});var a=n(223),r=n(7451),i=n(75418),l=n.n(i),o=n(44274),c=n(75381),u=n(99421),s=n(59909),d=n(28962),v=n(5569),f=function(){var e=(0,s.useTranslation)(["kasTemporaryFixMe"]).t;return l().createElement(u.PageSection,{variant:u.PageSectionVariants.default,padding:{default:"noPadding"},isFilled:!0},l().createElement(d.C0,{titleProps:{title:e("serviceAccount.unauthorized_access_to_service_accounts_title"),headingLevel:"h2"},emptyStateIconProps:{icon:v.ZP},emptyStateBodyProps:{body:e("serviceAccount.unauthorized_access_to_service_accounts_info")}}))},m=function(e){var t,n=e.fetchServiceAccounts,a=(0,r.useModal)().showModal,i=(0,s.useTranslation)(["kasTemporaryFixMe"]).t;return l().createElement(u.PageSection,{padding:{default:"noPadding"},isFilled:!0},l().createElement(d.C0,{emptyStateProps:{variant:d.jU.NoItems},titleProps:{title:i("serviceAccount.you_do_not_have_any_service_accounts_yet")},emptyStateBodyProps:{body:i("serviceAccount.create_service_account_to_get_started")},buttonProps:(t={title:i("serviceAccount.create_service_account"),onClick:function(){a(r.ModalType.KasCreateServiceAccount,{onCreate:n})}},t["data-testid"]="emptyStateStreams-buttonCreateServiceAccount",t)}))},p=n(68199),_=n(57294),g=n(71070),S=function(e){var t=e.filterSelected,n=e.setFilterSelected,a=e.filteredValue,r=e.setFilteredValue,o=e.onCreateServiceAccount,c=(0,s.useTranslation)(["kasTemporaryFixMe"]).t,v=(0,i.useRef)(),f=(0,i.useRef)(),m=(0,i.useState)(!1),p=m[0],_=m[1],S=(0,i.useState)(!0),h=S[0],y=S[1],b=(0,i.useState)(!0),E=b[0],A=b[1],w=(0,i.useState)(!1),C=w[0],P=(w[1],(0,i.useState)()),T=P[0],V=P[1],k=(0,i.useState)(),I=k[0],F=k[1],x=[{label:c("name"),value:"name",disabled:!1},{label:c("owner"),value:"owner",disabled:!1}],B=function(e){return!e||/^([a-zA-Z0-9-_%]*[a-zA-Z0-9-_%])?$/.test(e.trim())},D=function(e,t,n){var i=Object.assign([],a),l=i.findIndex((function(t){return t.filterKey===e}));if(l>-1){var o=i[l];if(o.filterValue&&o.filterValue.length>0){var c=o.filterValue.findIndex((function(e){return e.value===t.value}));if(c>-1){if(!n)return;o.filterValue.splice(c,1)}else i[l].filterValue.push(t)}else i[l].filterValue=[t]}else i.push({filterKey:e,filterValue:[t]});r(i)},M=function(e){"name"===e&&T&&""!=T.trim()?B(T)?(D("name",{value:T,isExact:!1},!1),V("")):y(!1):"owner"===e&&I&&""!=I.trim()&&(B(I)?(D("owner",{value:I,isExact:!1},!1),F("")):A(!1))},O=function(e){var t;if("Enter"===e.key&&!C){var n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.name;M(n)}},R=function(e){return C?l().createElement("div",null,c("max_filter_message")):l().createElement("div",null,c("input_field_invalid_message",{name:e}))},K=function(e){var t=a.filter((function(t){return t.filterKey===e}));return t.length>0?t[0].filterValue.map((function(e){return e.value})):[]},L=function(e,t,n){var i,l,o=Object.assign([],a),c=o.findIndex((function(t){return t.filterKey===e})),u=Object.assign([],null===(i=o[c])||void 0===i?void 0:i.filterValue),s=t.toString();n&&(null==n?void 0:n.length)>0&&(s=null===(l=null==n?void 0:n.find((function(e){return e.label===t.toString()})))||void 0===l?void 0:l.value);var d=u.findIndex((function(e){return e.value===s}));d>=0&&(o[c].filterValue.splice(d,1),r(o))},j=function(e){var t=Object.assign([],a),n=t.findIndex((function(t){return t.filterKey===e}));n>=0&&(t.splice(n,1),r(t))},U=(l().createElement(l().Fragment,null,l().createElement(u.ToolbarGroup,{variant:"filter-group"},l().createElement(u.ToolbarItem,null,l().createElement(u.Select,{variant:u.SelectVariant.single,"aria-label":"Select filter",onToggle:function(){_(!p)},selections:t,isOpen:p,onSelect:function(e,t){_(!p),n(null==t?void 0:t.toString())}},x.map((function(e,t){return l().createElement(u.SelectOption,{isDisabled:e.disabled,key:t,value:e.value},e.label)})))),l().createElement(u.ToolbarFilter,{chips:K("name"),deleteChip:function(e,t){return L("name",t)},deleteChipGroup:function(){return j("name")},categoryName:c("name")},"name"===(null==t?void 0:t.toLowerCase())&&l().createElement(u.ToolbarItem,null,l().createElement(u.InputGroup,null,l().createElement(u.TextInput,{name:"name",id:"name-input",type:"search","aria-label":c("filter_by_name_lower"),validated:!h||C?u.ValidatedOptions.error:u.ValidatedOptions.default,placeholder:c("filter_by_name_lower"),onChange:function(e){V(e),!h&&y(!0)},onKeyPress:O,value:T,ref:v}),l().createElement(u.Button,{variant:u.ButtonVariant.control,isDisabled:!h||C,onClick:function(){return M("name")},"aria-label":c("filter_by_name_lower")},l().createElement(g.ZP,null)),(!h||C)&&l().createElement(u.Tooltip,{isVisible:C||!h,content:R("name"),reference:v})))),l().createElement(u.ToolbarFilter,{chips:K("owner"),deleteChip:function(e,t){return L("owner",t)},deleteChipGroup:function(){return j("owner")},categoryName:c("owner")},"owner"===(null==t?void 0:t.toLowerCase())&&l().createElement(u.ToolbarItem,null,l().createElement(u.InputGroup,null,l().createElement(u.TextInput,{name:"owner",id:"owner-input",type:"search","aria-label":c("filter_by_owner"),placeholder:c("filter_by_owner"),validated:!E||C?u.ValidatedOptions.error:u.ValidatedOptions.default,onChange:function(e){F(e),!E&&A(!0)},onKeyPress:O,value:I,ref:f}),l().createElement(u.Button,{isDisabled:!E||C,variant:u.ButtonVariant.control,onClick:function(){return M("owner")},"aria-label":c("filter_by_owner")},l().createElement(g.ZP,null)),(!E||C)&&l().createElement(u.Tooltip,{isVisible:C||!E,content:R("owner"),reference:f})))))),[{item:l().createElement(u.Button,{variant:"primary",onClick:o,"data-testid":"tableServiceAccounts-buttonCreateServiceAccount"},c("serviceAccount.create_service_account"))}]);return l().createElement(d.L5,{toolbarProps:{id:"instance-toolbar",clearAllFilters:function(){r([])},collapseListedFiltersBreakpoint:"md",inset:{xl:"insetLg"}},toolbarItems:U})},h=function(e){var t=e.page,n=e.perPage,o=e.expectedTotal,v=e.total,f=e.serviceAccountsDataLoaded,m=e.serviceAccountItems,p=e.onResetCredentials,g=e.onDeleteServiceAccount,h=e.orderBy,y=e.setOrderBy,b=e.filteredValue,E=e.setFilteredValue,A=e.filterSelected,w=e.setFilterSelected,C=e.onCreateServiceAccount,P=e.mainToggle,T=(0,s.useTranslation)(["kasTemporaryFixMe"]).t,V=(0,r.useAuth)(),k=(0,i.useState)(void 0),I=k[0],F=k[1],x=(0,i.useState)(),B=x[0],D=x[1];(0,i.useEffect)((function(){null==V||V.getUsername().then((function(e){return F(e)}))}),[]),(0,i.useEffect)((function(){null==V||V.isOrgAdmin().then((function(e){return D(e)}))}),[V]);var M,O,R=[{title:T("common.name")},{title:T("common.clientID")},{title:T("common.owner"),transforms:[(0,_.cellWidth)(20)]},{title:T("time_created")}],K=function(e){var t,n;if(!f)return[];var r,i=e.originalData,l=i.owner===I||B;l||(r={tooltip:!0,isDisabled:!0,style:{pointerEvents:"auto",cursor:"default"}});var o=[(0,a.__assign)((0,a.__assign)((t={title:T("common.reset_credentials"),id:"reset-credentials"},t["data-testid"]="tableServiceAccounts-actionResetCredentials",t.onClick=function(e){return l&&function(e,t){var n,a,r,i;p&&p(t),null===(i=null===(r=null===(a=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.parentElement)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.previousSibling)||void 0===i||i.focus()}(e,i)},t),r),{tooltipProps:{position:"left",content:T("serviceAccount.no_permission_to_reset_service_account")}}),(0,a.__assign)((0,a.__assign)((n={title:T("serviceAccount.delete_service_account"),id:"delete-account"},n["data-testid"]="tableServiceAccounts-actionDeleteAccount",n.onClick=function(e){return l&&function(e,t){var n,a,r,i;g&&g(t),null===(i=null===(r=null===(a=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.parentElement)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.previousSibling)||void 0===i||i.focus()}(e,i)},n),r),{tooltipProps:{position:"left",content:T("serviceAccount.no_permission_to_delete_service_account")}})];return o},L=function(e){switch(e.toLowerCase()){case"name":return 0;case"client_id":return 1;case"owner":return 2;case"description":return 3;case"created_at":return 4;default:return}};return l().createElement(l().Fragment,null,l().createElement(S,{filterSelected:A,setFilterSelected:w,total:v,page:t,perPage:n,filteredValue:b,setFilteredValue:E,onCreateServiceAccount:C,mainToggle:P}),l().createElement(d.wR,{tableProps:{cells:R,rows:(M=[],O=(0,c.o8)(t,n,o),f?(null==m||m.forEach((function(e){var t=e.name,n=e.owner,a=e.client_id,r=e.created_at;M.push({cells:[t,a,n,{title:(0,c.L0)(r,T("ago"))}],originalData:e})})),M):(0,c.vK)({loadingCount:O,skeleton:l().createElement(u.Skeleton,null),length:R.length})),"aria-label":T("serviceAccount.service_account_list"),actionResolver:function(e){return K(e)},onSort:function(e,t,n){y&&y("".concat(function(e){switch(e){case 0:return"name";case 1:return"client_id";case 2:return"owner";case 3:return"description";case 4:return"created_at";default:return""}}(t)," ").concat(n))},sortBy:function(){var e=(null==h?void 0:h.split(" "))||[];if(e.length>1)return{index:L(e[0]),direction:e[1]===_.SortByDirection.asc?_.SortByDirection.asc:_.SortByDirection.desc}}()}}),m&&(null==m?void 0:m.length)<1&&f&&l().createElement(d.C0,{emptyStateProps:{variant:d.jU.NoResult},titleProps:{title:T("no_results_found")},emptyStateBodyProps:{body:T("adjust_your_filters_and_try_again")}}))},y=function(e){var t=e.fetchServiceAccounts,n=e.serviceAccountItems,a=(0,r.useModal)().showModal,o=(0,r.useModal)().showModal,c=(0,r.useModal)().showModal,s=(0,p.useLocation)(),v=(0,i.useState)("name asc"),f=v[0],m=v[1],_=(0,i.useState)("name"),g=_[0],S=_[1],y=(0,i.useState)([]),b=y[0],E=y[1],A=new URLSearchParams(s.search),w=(0,d.h0)()||{},C=w.page,P=void 0===C?1:C,T=w.perPage,V=void 0===T?10:T,k=A.has("user-testing");return l().createElement(u.PageSection,{className:"mk--main-page__page-section--table pf-m-padding-on-xl",variant:u.PageSectionVariants.default,padding:{default:"noPadding"}},l().createElement(u.Card,null,l().createElement(h,{page:P,perPage:V,total:1,expectedTotal:0,serviceAccountsDataLoaded:!0,serviceAccountItems:n,orderBy:f,setOrderBy:m,filterSelected:g,setFilterSelected:S,filteredValue:b,setFilteredValue:E,onResetCredentials:function(e){a(r.ModalType.KasResetServiceAccountCredentials,{serviceAccount:e})},onDeleteServiceAccount:function(e){c(r.ModalType.KasDeleteServiceAccount,{serviceAccount:e,onDelete:t})},onCreateServiceAccount:function(){o(r.ModalType.KasCreateServiceAccount,{onCreate:t})},mainToggle:k})))},b=function(){var e=(0,r.useAuth)(),t=(0,r.useConfig)(),n=(0,i.useState)(),s=n[0],v=n[1],p=(0,i.useState)(!1),_=p[0],g=p[1],S=function(){return(0,a.__awaiter)(void 0,void 0,void 0,(function(){var n,r;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return[4,null==e?void 0:e.kas.getToken()];case 1:if(!(n=a.sent())||!t)return[3,5];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,new o.SecurityApi(new o.Configuration({accessToken:n,basePath:null===(r=null==t?void 0:t.ams)||void 0===r?void 0:r.apiBasePath})).getServiceAccounts().then((function(e){var t=null==e?void 0:e.data,n=(null==t?void 0:t.items)||[],a=null==n?void 0:n.sort((function(e,t){return e.created_at&&t.created_at?t.created_at.localeCompare(e.created_at):-1}));v(a)}))];case 3:return a.sent(),[3,5];case 4:return function(e){var t,n,a;(0,c.G6)(e)&&(a=null===(n=null===(t=e.response)||void 0===t?void 0:t.data)||void 0===n?void 0:n.code),a===c.SM.UNAUTHORIZED_USER&&g(!0)}(a.sent()),[3,5];case 5:return[2]}}))}))};return(0,i.useEffect)((function(){S()}),[e,t]),_?l().createElement(f,null):void 0===s?l().createElement(u.PageSection,{variant:u.PageSectionVariants.light,padding:{default:"noPadding"}},l().createElement(d.yR,null)):s.length<1?l().createElement(m,{fetchServiceAccounts:S}):l().createElement(y,{fetchServiceAccounts:S,serviceAccountItems:s})}}}]);
//# sourceMappingURL=8364.4c987eb5.js.map