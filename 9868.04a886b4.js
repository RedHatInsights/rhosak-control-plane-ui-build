"use strict";(self.webpackChunkkas_ui=self.webpackChunkkas_ui||[]).push([[9868],{88601:(e,a,i)=>{i.d(a,{c:()=>v,d:()=>c});var n=i(97644),t=i(74142),o=i(53824),r=i(31683),l=i(9669),d=i.n(l),s=i(93264);const u=(0,r.createCacheAdapter)({debug:null!==localStorage.getItem("log-axios")}),c=()=>{const e=(0,n.useAuth)(),{kas:{apiBasePath:a}}=(0,n.useConfig)();return(0,s.useCallback)((()=>new o.DefaultApi(new o.Configuration({accessToken:e.kas.getToken(),basePath:a}),void 0,d().create({adapter:u,cache:15e3}))),[e.kas,a])},v=()=>{const e=(0,n.useAuth)(),{ams:{apiBasePath:a}}=(0,n.useConfig)();return(0,s.useCallback)((()=>new t.AppServicesApi(new o.Configuration({accessToken:e.ams.getToken(),basePath:a}),void 0,d().create({adapter:u,cache:15e3}))),[a,e.ams])}},94622:(e,a,i)=>{i.d(a,{A:()=>l});var n=i(85893),t=i(93264),o=i(15847),r=i(97644);const l=()=>{const{registerModals:e}=(0,r.useModal)();return e((()=>{const{t:e}=(0,o.useTranslation)(["kasTemporaryFixMe"]);return{[r.ModalType.KasCreateInstance]:{lazyComponent:(0,t.lazy)((()=>Promise.all([i.e(9669),i.e(3651),i.e(2695),i.e(3685),i.e(3824),i.e(5781),i.e(69),i.e(4372)]).then(i.bind(i,74372)))),variant:"medium",title:e("create_a_kafka_instance")},[r.ModalType.KasDeleteInstance]:{lazyComponent:(0,t.lazy)((()=>Promise.all([i.e(9669),i.e(3651),i.e(2695),i.e(4785),i.e(3685),i.e(3824),i.e(3133),i.e(5626),i.e(5781),i.e(524)]).then(i.bind(i,78578)))),variant:"small"},[r.ModalType.KasTransferOwnership]:{lazyComponent:(0,t.lazy)((()=>Promise.all([i.e(9669),i.e(2695),i.e(4785),i.e(3824),i.e(5781),i.e(8512)]).then(i.bind(i,98512)))),variant:"medium",title:e("change_owner")},[r.ModalType.KasCreateServiceAccount]:{lazyComponent:(0,t.lazy)((()=>Promise.all([i.e(3651),i.e(2695),i.e(4785),i.e(3685),i.e(3824),i.e(3133),i.e(5626),i.e(854),i.e(8752)]).then(i.bind(i,45587)))),variant:"medium",title:e("serviceAccount.create_a_service_account")},[r.ModalType.KasDeleteServiceAccount]:{lazyComponent:(0,t.lazy)((()=>Promise.all([i.e(3651),i.e(2695),i.e(4785),i.e(3685),i.e(3824),i.e(3133),i.e(5626),i.e(854),i.e(645)]).then(i.bind(i,88372)))),title:e("serviceAccount.delete_service_account")+"?",variant:"small"},[r.ModalType.KasResetServiceAccountCredentials]:{lazyComponent:(0,t.lazy)((()=>Promise.all([i.e(3651),i.e(2695),i.e(4785),i.e(3685),i.e(3824),i.e(3133),i.e(5626),i.e(854),i.e(4410)]).then(i.bind(i,99240)))),title:`${e("serviceAccount.reset_service_account_credentials")}?`,variant:"medium"}}})()),(0,n.jsx)(n.Fragment,{})}},63286:(e,a,i)=>{var n;i.d(a,{Z:()=>n}),function(e){e.DETAILS="details",e.CONNECTION="connection"}(n||(n={}))},24584:(e,a,i)=>{i.d(a,{b4:()=>p,qT:()=>v,DO:()=>h,TM:()=>m,AU:()=>f,dt:()=>b,df:()=>y,s9:()=>c});var n=i(42695),t=i(88601),o=i(75381),r=i(97644),l=i(93264);const d="rhosak";function s(e){var a;return null===(a=e.related_resources)||void 0===a?void 0:a.find((e=>"standard"===e.billing_model))}function u(e){var a;return null===(a=e.related_resources)||void 0===a?void 0:a.find((e=>"marketplace"===e.billing_model))}const c=()=>{const e=(0,t.c)();return(0,l.useCallback)((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var a,i,n,t;const o=e(),r=yield o.apiAccountsMgmtV1CurrentAccountGet(),l=null===(i=null===(a=null==r?void 0:r.data)||void 0===a?void 0:a.organization)||void 0===i?void 0:i.id;if(!l)throw new Error("User has no organization id");const c=yield o.apiAccountsMgmtV1OrganizationsOrgIdQuotaCostGet(l,void 0,!0,void 0,!0);if(200!==c.status)throw new Error(c.statusText);const v=null===(n=c.data.items)||void 0===n?void 0:n.filter((e=>{var a;return null===(a=e.related_resources)||void 0===a?void 0:a.find((e=>e.resource_name===d&&"RHOSAK"===e.product))})),p=null==v?void 0:v.find(s),m=(null==v?void 0:v.some(u))?null==v?void 0:v.filter(u):void 0,_=void 0===p&&void 0===m&&(null===(t=c.data.items)||void 0===t?void 0:t.some((e=>{var a;return null===(a=e.related_resources)||void 0===a?void 0:a.find((e=>e.resource_name===d&&"RHOSAKTrial"===e.product))})))||!1,f=p?p.allowed-p.consumed:void 0,b=m?m.reduce(((e,a)=>a.allowed-a.consumed+e),0):void 0,y=null==m?void 0:m.filter((e=>void 0!==e.cloud_accounts)).flatMap((e=>e.cloud_accounts)),g=Array.from(new Set(null==y?void 0:y.map((e=>e.cloud_provider_id))));return{hasTrialQuota:_,remainingPrepaidQuota:f,remainingMarketplaceQuota:b,marketplaceSubscriptions:y?g.map((e=>({marketplace:e,subscriptions:y.filter((a=>a.cloud_provider_id===e)).map((e=>e.cloud_account_id))}))):[]}}))),[e])},v=()=>{const e=c();return(0,l.useCallback)((({onNoQuotaAvailable:a,onOutOfQuota:i,onQuotaAvailable:t})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const{hasTrialQuota:n,remainingPrepaidQuota:o,remainingMarketplaceQuota:r,marketplaceSubscriptions:l}=yield e();void 0!==r||void 0!==o?0===(r||0)&&0===(o||0)?i({quota:{marketplaceSubscriptions:l}}):t({quota:{remainingPrepaidQuota:o,remainingMarketplaceQuota:r,marketplaceSubscriptions:l}}):a({hasTrialQuota:n})}catch(e){a({hasTrialQuota:!1})}}))),[e])},p=()=>{const{getUsername:e}=(0,r.useAuth)(),a=(0,t.d)(),i=(0,l.useCallback)((({onAvailable:i,onUnavailable:t,onUsed:r})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const n=a(),t=`owner = ${yield e()}`,l=yield n.getKafkas("","","",t);if(l.data.items){l.data.items.some((e=>(null==e?void 0:e.instance_type)===(null===o.ik||void 0===o.ik?void 0:o.ik.eval)||(null==e?void 0:e.instance_type)===(null===o.ik||void 0===o.ik?void 0:o.ik.developer)))?r():i()}}catch(e){t()}}))),[a,e]);return i},m=()=>{const e=(0,t.d)(),a=_(),i=(0,l.useCallback)(((i,{onAvailable:t,onUnavailable:o})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var r;try{const o=e(),l=yield o.getCloudProviders(),d=(null===(r=null==l?void 0:l.data)||void 0===r?void 0:r.items)||[],s=(yield Promise.all(d.filter((e=>e.enabled)).map((e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield a(e.id,i),t={id:e.id,displayName:e.display_name,regions:n};return n.length>0?t:null})))))).filter((e=>Boolean(e)));if(0===s.length)throw new Error("No available providers");const u=s[0];t({providers:s,defaultProvider:null==u?void 0:u.id})}catch(e){o()}}))),[a,e]);return i},_=()=>{const e=(0,t.d)();return(0,l.useCallback)((function(a,i){var t;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=e(),o=yield n.getCloudProviderRegions(a);if(!(null===(t=null==o?void 0:o.data)||void 0===t?void 0:t.items))return[];return o.data.items.filter((e=>e.enabled&&e.capacity.some((e=>e.instance_type===i)))).map((e=>{var a;const n=null===(a=e.capacity)||void 0===a?void 0:a.some((e=>{var a;return e.instance_type===i&&0===(null===(a=e.available_sizes)||void 0===a?void 0:a.length)}));return{id:e.id,displayName:e.display_name,isDisabled:n,capacity:e.capacity}}))}))}),[e])},f=e=>{const a=(0,t.d)(),i=_();return(0,l.useCallback)(((t,o)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,r,l;const d=a(),s=(yield i(t,e)).find((e=>e.id===o)),u=(null==s?void 0:s.capacity.flatMap((e=>e.available_sizes.map((a=>`${e.instance_type}.${a}`)))))||[],c=yield d.getInstanceTypesByCloudProviderAndRegion(t,o);if(!(null===(n=null==c?void 0:c.data)||void 0===n?void 0:n.instance_types))throw new Error("No instance_types from backend");return((null===(l=null===(r=null==c?void 0:c.data)||void 0===r?void 0:r.instance_types.find((a=>a.id===e)))||void 0===l?void 0:l.sizes)||[]).map(g.bind(void 0,(a=>!u.includes(`${e}.${a}`))))}))),[i,a,e])},b=()=>f("standard"),y=()=>{const e=f("standard"),a=f("developer");return(0,l.useCallback)(((i,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){let n;try{if(n=yield e(i,t),0===n.length)throw new Error("Couldn't load standard sizes")}catch(e){n=[{id:"1",displayName:"1",quota:1},{id:"2",displayName:"2",quota:2}]}return{standard:n,trial:(yield a(i,t))[0]}}))),[a,e])};function g(e,a){const i=a;return{id:i.id,displayName:i.display_name,quota:i.quota_consumed,ingress:(i.ingress_throughput_per_sec.bytes||0)/1048576,egress:(i.egress_throughput_per_sec.bytes||0)/1048576,storage:Math.round((i.max_data_retention_size.bytes||0)/1073741824),connections:i.total_max_connections,connectionRate:i.max_connection_attempts_per_sec,maxPartitions:i.max_partitions,messageSize:(i.max_message_size.bytes||0)/1048576,status:"stable"===i.maturity_status?"stable":"preview",trialDurationHours:i.lifespan_seconds?i.lifespan_seconds/60/60:0,isDisabled:e(i.id)}}var k=i(78261);const h=()=>{const e=(0,t.d)();return(a,i,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const r=e();try{const e=(e=>{if(void 0===e.name.value)throw new Error("kafkaRequest.name must not be undefined");if(void 0===e.region.value)throw new Error("kafkaRequest.region must not be undefined");if(void 0===e.multi_az.value)throw new Error("kafkaRequest.multi_az must not be undefined");if(void 0===e.cloud_provider.value)throw new Error("kafkaRequest.cloud_provider must not be undefined");return{name:e.name.value,region:e.region.value,cloud_provider:e.cloud_provider.value}})({cloud_provider:{value:""},multi_az:{value:!0},region:{value:""},name:{value:""}});e.name=a.name,e.cloud_provider=a.provider,e.region=a.region,e.plan=a.plan+"."+a.sizeId,e.billing_model="prepaid"===a.billing?"standard":void 0!==a.billing?"marketplace":null,e.billing_cloud_account_id=a.billing&&"prepaid"!==a.billing?a.billing.subscription:null,yield r.createKafka(!0,e),i()}catch(e){if((0,k.G6)(e)){const{code:i}=(null===(n=null==e?void 0:e.response)||void 0===n?void 0:n.data)||{};switch(a.plan){case"developer":if(i===o.SM.DUPLICATE_INSTANCE_NAME)t("name-taken");else t("developer-unavailable");break;case"standard":switch(i){case o.SM.DUPLICATE_INSTANCE_NAME:t("name-taken");break;case o.SM.INTERNAL_CAPACITY_ERROR:t("region-unavailable");break;case o.SM.INSUFFICIENT_QUOTA:t("insufficient-quota");break;default:console.error("useAvailableProvidersAndDefault","createKafka unknown error",e),t("unknown")}}}else console.error("useAvailableProvidersAndDefault","createKafka unexpected error",e)}}))}}}]);
//# sourceMappingURL=9868.04a886b4.js.map