"use strict";(self.webpackChunkkas_ui=self.webpackChunkkas_ui||[]).push([[8364],{48364:(e,t,n)=>{n.d(t,{H:()=>b});var r=n(70655),a=n(11593),i=n(62308),l=n(75418),o=n.n(l),c=n(55277),u=n(75381),s=n(84669),d=n(92550),v=n(5569),f=function(){var e=(0,a.useTranslation)().t;return o().createElement(s.PageSection,{variant:s.PageSectionVariants.default,padding:{default:"noPadding"},isFilled:!0},o().createElement(d.C0,{titleProps:{title:e("serviceAccount.unauthorized_access_to_service_accounts_title"),headingLevel:"h2"},emptyStateIconProps:{icon:v.ZP},emptyStateBodyProps:{body:e("serviceAccount.unauthorized_access_to_service_accounts_info")}}))},m=function(e){var t,n=e.fetchServiceAccounts,r=(0,d.QK)().showModal,i=(0,a.useTranslation)().t;return o().createElement(s.PageSection,{padding:{default:"noPadding"},isFilled:!0},o().createElement(d.C0,{emptyStateProps:{variant:d.jU.NoItems},titleProps:{title:i("serviceAccount.you_do_not_have_any_service_accounts_yet")},emptyStateBodyProps:{body:i("serviceAccount.create_service_account_to_get_started")},buttonProps:(t={title:i("serviceAccount.create_service_account"),onClick:function(){r(d.Ng.CREATE_SERVICE_ACCOUNT,{fetchServiceAccounts:n})}},t["data-testid"]="emptyStateStreams-buttonCreateServiceAccount",t)}))},p=n(98068),_=n(27577),g=n(71070),S=function(e){var t=e.filterSelected,n=e.setFilterSelected,r=e.filteredValue,i=e.setFilteredValue,c=e.onCreateServiceAccount,u=(0,a.useTranslation)().t,v=(0,l.useRef)(),f=(0,l.useRef)(),m=(0,l.useState)(!1),p=m[0],_=m[1],S=(0,l.useState)(!0),E=S[0],h=S[1],b=(0,l.useState)(!0),A=b[0],y=b[1],C=(0,l.useState)(!1),w=C[0],P=(C[1],(0,l.useState)()),T=P[0],V=P[1],I=(0,l.useState)(),k=I[0],R=I[1],D=[{label:u("name"),value:"name",disabled:!1},{label:u("owner"),value:"owner",disabled:!1}],B=function(e){return!e||/^([a-zA-Z0-9-_%]*[a-zA-Z0-9-_%])?$/.test(e.trim())},x=function(e,t,n){var a=Object.assign([],r),l=a.findIndex((function(t){return t.filterKey===e}));if(l>-1){var o=a[l];if(o.filterValue&&o.filterValue.length>0){var c=o.filterValue.findIndex((function(e){return e.value===t.value}));if(c>-1){if(!n)return;o.filterValue.splice(c,1)}else a[l].filterValue.push(t)}else a[l].filterValue=[t]}else a.push({filterKey:e,filterValue:[t]});i(a)},O=function(e){"name"===e&&T&&""!=T.trim()?B(T)?(x("name",{value:T,isExact:!1},!1),V("")):h(!1):"owner"===e&&k&&""!=k.trim()&&(B(k)?(x("owner",{value:k,isExact:!1},!1),R("")):y(!1))},F=function(e){var t;if("Enter"===e.key&&!w){var n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.name;O(n)}},N=function(e){return w?o().createElement("div",null,u("max_filter_message")):o().createElement("div",null,u("input_field_invalid_message",{name:e}))},L=function(e){var t=r.filter((function(t){return t.filterKey===e}));return t.length>0?t[0].filterValue.map((function(e){return e.value})):[]},K=function(e,t,n){var a,l,o=Object.assign([],r),c=o.findIndex((function(t){return t.filterKey===e})),u=Object.assign([],null===(a=o[c])||void 0===a?void 0:a.filterValue),s=t.toString();n&&(null==n?void 0:n.length)>0&&(s=null===(l=null==n?void 0:n.find((function(e){return e.label===t.toString()})))||void 0===l?void 0:l.value);var d=u.findIndex((function(e){return e.value===s}));d>=0&&(o[c].filterValue.splice(d,1),i(o))},U=function(e){var t=Object.assign([],r),n=t.findIndex((function(t){return t.filterKey===e}));n>=0&&(t.splice(n,1),i(t))},j=(o().createElement(o().Fragment,null,o().createElement(s.ToolbarGroup,{variant:"filter-group"},o().createElement(s.ToolbarItem,null,o().createElement(s.Select,{variant:s.SelectVariant.single,"aria-label":"Select filter",onToggle:function(){_(!p)},selections:t,isOpen:p,onSelect:function(e,t){_(!p),n(null==t?void 0:t.toString())}},D.map((function(e,t){return o().createElement(s.SelectOption,{isDisabled:e.disabled,key:t,value:e.value},e.label)})))),o().createElement(s.ToolbarFilter,{chips:L("name"),deleteChip:function(e,t){return K("name",t)},deleteChipGroup:function(){return U("name")},categoryName:u("name")},"name"===(null==t?void 0:t.toLowerCase())&&o().createElement(s.ToolbarItem,null,o().createElement(s.InputGroup,{className:"mk--filter-instances__toolbar--text-input"},o().createElement(s.TextInput,{name:"name",id:"name-input",type:"search","aria-label":u("filter_by_name_lower"),validated:!E||w?s.ValidatedOptions.error:s.ValidatedOptions.default,placeholder:u("filter_by_name_lower"),onChange:function(e){V(e),!E&&h(!0)},onKeyPress:F,value:T,ref:v}),o().createElement(s.Button,{variant:s.ButtonVariant.control,isDisabled:!E||w,onClick:function(){return O("name")},"aria-label":u("filter_by_name_lower")},o().createElement(g.ZP,null)),(!E||w)&&o().createElement(s.Tooltip,{isVisible:w||!E,content:N("name"),reference:v})))),o().createElement(s.ToolbarFilter,{chips:L("owner"),deleteChip:function(e,t){return K("owner",t)},deleteChipGroup:function(){return U("owner")},categoryName:u("owner")},"owner"===(null==t?void 0:t.toLowerCase())&&o().createElement(s.ToolbarItem,null,o().createElement(s.InputGroup,{className:"mk--filter-instances__toolbar--text-input"},o().createElement(s.TextInput,{name:"owner",id:"owner-input",type:"search","aria-label":u("filter_by_owner"),placeholder:u("filter_by_owner"),validated:!A||w?s.ValidatedOptions.error:s.ValidatedOptions.default,onChange:function(e){R(e),!A&&y(!0)},onKeyPress:F,value:k,ref:f}),o().createElement(s.Button,{isDisabled:!A||w,variant:s.ButtonVariant.control,onClick:function(){return O("owner")},"aria-label":u("filter_by_owner")},o().createElement(g.ZP,null)),(!A||w)&&o().createElement(s.Tooltip,{isVisible:w||!A,content:N("owner"),reference:f})))))),[{item:o().createElement(s.Button,{variant:"primary",onClick:c,"data-testid":"tableServiceAccounts-buttonCreateServiceAccount"},u("serviceAccount.create_service_account"))}]);return o().createElement(d.L5,{toolbarProps:{id:"instance-toolbar",clearAllFilters:function(){i([])},collapseListedFiltersBreakpoint:"md",inset:{xl:"insetLg"}},toolbarItems:j})},E=function(e){var t=e.page,n=e.perPage,c=e.expectedTotal,v=e.total,f=e.serviceAccountsDataLoaded,m=e.serviceAccountItems,p=e.onResetCredentials,g=e.onDeleteServiceAccount,E=e.orderBy,h=e.setOrderBy,b=e.filteredValue,A=e.setFilteredValue,y=e.filterSelected,C=e.setFilterSelected,w=e.onCreateServiceAccount,P=e.mainToggle,T=(0,a.useTranslation)().t,V=(0,i.useAuth)(),I=(0,l.useState)(void 0),k=I[0],R=I[1],D=(0,l.useState)(),B=D[0],x=D[1];(0,l.useEffect)((function(){null==V||V.getUsername().then((function(e){return R(e)}))}),[]),(0,l.useEffect)((function(){null==V||V.isOrgAdmin().then((function(e){return x(e)}))}),[V]);var O,F,N=[{title:T("common.name")},{title:T("common.clientID")},{title:T("common.owner"),transforms:[(0,_.cellWidth)(20)]},{title:T("common.description")},{title:T("time_created")}],L=function(e){var t,n;if(!f)return[];var a,i=e.originalData,l=i.owner===k||B;l||(a={tooltip:!0,isDisabled:!0,style:{pointerEvents:"auto",cursor:"default"}});var o=[(0,r.__assign)((0,r.__assign)((t={title:T("common.reset_credentials"),id:"reset-credentials"},t["data-testid"]="tableServiceAccounts-actionResetCredentials",t.onClick=function(e){return l&&function(e,t){var n,r,a,i;p&&p(t),null===(i=null===(a=null===(r=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.parentElement)||void 0===r?void 0:r.parentElement)||void 0===a?void 0:a.previousSibling)||void 0===i||i.focus()}(e,i)},t),a),{tooltipProps:{position:"left",content:T("serviceAccount.no_permission_to_reset_service_account")}}),(0,r.__assign)((0,r.__assign)((n={title:T("serviceAccount.delete_service_account"),id:"delete-account"},n["data-testid"]="tableServiceAccounts-actionDeleteAccount",n.onClick=function(e){return l&&function(e,t){var n,r,a,i;g&&g(t),null===(i=null===(a=null===(r=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.parentElement)||void 0===r?void 0:r.parentElement)||void 0===a?void 0:a.previousSibling)||void 0===i||i.focus()}(e,i)},n),a),{tooltipProps:{position:"left",content:T("serviceAccount.no_permission_to_delete_service_account")}})];return o},K=function(e){switch(e.toLowerCase()){case"name":return 0;case"client_id":return 1;case"owner":return 2;case"description":return 3;case"created_at":return 4;default:return}};return o().createElement(o().Fragment,null,o().createElement(S,{filterSelected:y,setFilterSelected:C,total:v,page:t,perPage:n,filteredValue:b,setFilteredValue:A,onCreateServiceAccount:w,mainToggle:P}),o().createElement(d.wR,{tableProps:{cells:N,rows:(O=[],F=(0,u.o8)(t,n,c),f?(null==m||m.forEach((function(e){var t=e.name,n=e.owner,r=e.description,a=e.client_id,i=e.created_at;O.push({cells:[t,a,n,r,{title:(0,u.L0)(i,T("ago"))}],originalData:e})})),O):(0,u.vK)({loadingCount:F,skeleton:o().createElement(s.Skeleton,null),length:N.length})),"aria-label":T("serviceAccount.service_account_list"),actionResolver:function(e){return L(e)},onSort:function(e,t,n){h&&h(function(e){switch(e){case 0:return"name";case 1:return"client_id";case 2:return"owner";case 3:return"description";case 4:return"created_at";default:return""}}(t)+" "+n)},sortBy:function(){var e=(null==E?void 0:E.split(" "))||[];if(e.length>1)return{index:K(e[0]),direction:e[1]===_.SortByDirection.asc?_.SortByDirection.asc:_.SortByDirection.desc}}()}}),m&&(null==m?void 0:m.length)<1&&f&&o().createElement(d.C0,{emptyStateProps:{variant:d.jU.NoResult},titleProps:{title:T("no_results_found")},emptyStateBodyProps:{body:T("adjust_your_filters_and_try_again")}}))},h=function(e){var t=e.fetchServiceAccounts,n=e.serviceAccountItems,r=(0,d.QK)().showModal,a=(0,p.useLocation)(),i=(0,l.useState)("name asc"),c=i[0],u=i[1],v=(0,l.useState)("name"),f=v[0],m=v[1],_=(0,l.useState)([]),g=_[0],S=_[1],h=new URLSearchParams(a.search),b=(0,d.h0)()||{},A=b.page,y=void 0===A?1:A,C=b.perPage,w=void 0===C?10:C,P=h.has("user-testing");return o().createElement(s.PageSection,{className:"mk--main-page__page-section--table pf-m-padding-on-xl",variant:s.PageSectionVariants.default,padding:{default:"noPadding"}},o().createElement(s.Card,null,o().createElement(E,{page:y,perPage:w,total:1,expectedTotal:0,serviceAccountsDataLoaded:!0,serviceAccountItems:n,orderBy:c,setOrderBy:u,filterSelected:f,setFilterSelected:m,filteredValue:g,setFilteredValue:S,onResetCredentials:function(e){r(d.Ng.RESET_CREDENTIALS,{serviceAccountToReset:e})},onDeleteServiceAccount:function(e){r(d.Ng.DELETE_SERVICE_ACCOUNT,{serviceAccountToDelete:e,fetchServiceAccounts:t})},onCreateServiceAccount:function(){r(d.Ng.CREATE_SERVICE_ACCOUNT,{fetchServiceAccounts:t})},mainToggle:P})))},b=function(){var e=(0,a.useTranslation)().t,t=((0,i.useAlert)()||{}).addAlert,n=(0,i.useAuth)(),v=(0,i.useConfig)(),p=(0,l.useState)(),_=p[0],g=p[1],S=(0,l.useState)(!1),E=S[0],b=S[1],A=function(){return(0,r.__awaiter)(void 0,void 0,void 0,(function(){var a,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,null==n?void 0:n.kas.getToken()];case 1:if(!(a=r.sent())||!v)return[3,5];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,new c.SecurityApi(new c.Configuration({accessToken:a,basePath:null===(i=null==v?void 0:v.ams)||void 0===i?void 0:i.apiBasePath})).getServiceAccounts().then((function(e){var t=null==e?void 0:e.data,n=(null==t?void 0:t.items)||[],r=(0,u.E7)(n,"name","asc");g(r)}))];case 3:return r.sent(),[3,5];case 4:return function(n){var r,a,i,l,o;(0,u.G6)(n)&&(l=null===(r=n.response)||void 0===r?void 0:r.data.reason,o=null===(i=null===(a=n.response)||void 0===a?void 0:a.data)||void 0===i?void 0:i.code),o===u.SM.UNAUTHORIZED_USER?b(!0):t&&t({variant:s.AlertVariant.danger,title:e("common.something_went_wrong"),description:l})}(r.sent()),[3,5];case 5:return[2]}}))}))};return(0,l.useEffect)((function(){A()}),[n,v]),E?o().createElement(f,null):void 0===_?o().createElement(s.PageSection,{variant:s.PageSectionVariants.light,padding:{default:"noPadding"}},o().createElement(d.yR,null)):_.length<1?o().createElement(m,{fetchServiceAccounts:A}):o().createElement(h,{fetchServiceAccounts:A,serviceAccountItems:_})}}}]);
//# sourceMappingURL=8364.4b2f7c10.js.map